#!/bin/bash

[[ "${TRAVIS}" == 'true' ]] && echo -e "travis_fold:start:$0\033[33;1m$0\033[0m"

# Exit on first error
set -e

# Go to the top level directory of the repository
cd "$(git rev-parse --show-toplevel)"

# Use the environment variable if available
SHELLCHECK="${SHELLCHECK:-shellcheck}"

# Print the version only in CI
[[ "${TRAVIS}" == 'true' ]] && "${SHELLCHECK}" --version

# Run on all Bash scripts
#
# Ignore reports about expressions in single quotes. We intentionally put them
# there to avoid expansions.
# Reference: https://github.com/koalaman/shellcheck/wiki/SC2016
"${SHELLCHECK}" --shell=bash --exclude=SC2016 -- \
  prompt-hooks.bash \
  ./bin/* \
  ./tests/*.bats

[[ "${TRAVIS}" == 'true' ]] && echo "travis_fold:end:$0"
